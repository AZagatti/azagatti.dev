---
import { getCollection } from 'astro:content'
import { ArticlesList } from '../../components/articles-list'
import BaseLayout from '../../layouts/BaseLayout.astro'

export function getStaticPaths() {
  return [
    { params: { blog: undefined } },
    { params: { blog: 'en/blog' } },
  ]
}

const collection = (
  await getCollection('blog', ({ id }) => {
    return id.startsWith(`${Astro.currentLocale}/`)
  })
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
const frontmatters = (
  await Promise.all(
    collection.map(async (collection) => await collection.render())
  )
).map((item) => item.remarkPluginFrontmatter)
const posts = collection.map((post, index) => ({
  ...post,
  data: { ...post.data, minutesRead: frontmatters[index].minutesRead },
  slug: post.slug.split('/')[1]
}))
---

<BaseLayout title="AndrÃ© Zagatti Blog">
  <ArticlesList
    articles={posts}
    currentLocale={Astro.currentLocale as 'pt' | 'en'}
  />
</BaseLayout>
