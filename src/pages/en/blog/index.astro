---
import { getCollection } from 'astro:content'
import i18next, { changeLanguage } from 'i18next'
import { ArticlesList } from '../../../components/articles-list'
import BaseLayout from '../../../layouts/BaseLayout.astro'

changeLanguage('en')

const collection = await getCollection('blog', ({ id }) => {
  if (i18next.language === 'pt') {
    return id.includes('index.md')
  }
  return new RegExp(`${i18next.language}.md`).test(id)
})
const posts = collection.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)
const frontmatters = (
  await Promise.all(
    collection.map(async (collection) => await collection.render())
  )
).map((item) => item.remarkPluginFrontmatter)
const newPosts = posts.map((post, index) => ({
  ...post,
  data: { ...post.data, minutesRead: frontmatters[index].minutesRead },
}))
---

<BaseLayout title="AndrÃ© Zagatti Blog">
  <ArticlesList articles={newPosts} />
</BaseLayout>
